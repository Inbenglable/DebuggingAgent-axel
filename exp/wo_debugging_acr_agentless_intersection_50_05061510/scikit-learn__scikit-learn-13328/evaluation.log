============================= test session starts ==============================
platform linux -- Python 3.6.15, pytest-6.2.5, py-1.11.0, pluggy-1.0.0
rootdir: /data/swe-fl/TMP/testbed/scikit-learn__scikit-learn-13328, configfile: setup.cfg
collected 10 items

sklearn/linear_model/tests/test_huber.py ...FF.....                      [100%]

=================================== FAILURES ===================================
__________________________ test_huber_sample_weights ___________________________
TypeError: float() argument must be a string or a number, not 'csr_matrix'

The above exception was the direct cause of the following exception:

    def test_huber_sample_weights():
        # Test sample_weights implementation in HuberRegressor"""
    
        X, y = make_regression_with_outliers()
        huber = HuberRegressor(fit_intercept=True)
        huber.fit(X, y)
        huber_coef = huber.coef_
        huber_intercept = huber.intercept_
    
        # Rescale coefs before comparing with assert_array_almost_equal to make
        # sure that the number of decimal places used is somewhat insensitive to
        # the amplitude of the coefficients and therefore to the scale of the
        # data and the regularization parameter
        scale = max(np.mean(np.abs(huber.coef_)),
                    np.mean(np.abs(huber.intercept_)))
    
        huber.fit(X, y, sample_weight=np.ones(y.shape[0]))
        assert_array_almost_equal(huber.coef_ / scale, huber_coef / scale)
        assert_array_almost_equal(huber.intercept_ / scale,
                                  huber_intercept / scale)
    
        X, y = make_regression_with_outliers(n_samples=5, n_features=20)
        X_new = np.vstack((X, np.vstack((X[1], X[1], X[3]))))
        y_new = np.concatenate((y, [y[1]], [y[1]], [y[3]]))
        huber.fit(X_new, y_new)
        huber_coef = huber.coef_
        huber_intercept = huber.intercept_
        sample_weight = np.ones(X.shape[0])
        sample_weight[1] = 3
        sample_weight[3] = 2
        huber.fit(X, y, sample_weight=sample_weight)
    
        assert_array_almost_equal(huber.coef_ / scale, huber_coef / scale)
        assert_array_almost_equal(huber.intercept_ / scale,
                                  huber_intercept / scale)
    
        # Test sparse implementation with sample weights.
        X_csr = sparse.csr_matrix(X)
        huber_sparse = HuberRegressor(fit_intercept=True)
>       huber_sparse.fit(X_csr, y, sample_weight=sample_weight)

sklearn/linear_model/tests/test_huber.py:113: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
sklearn/linear_model/huber.py:253: in fit
    X = np.asarray(X, dtype=float)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = <5x20 sparse matrix of type '<class 'numpy.float64'>'
	with 100 stored elements in Compressed Sparse Row format>
dtype = <class 'float'>, order = None

    @set_module('numpy')
    def asarray(a, dtype=None, order=None):
        """Convert the input to an array.
    
        Parameters
        ----------
        a : array_like
            Input data, in any form that can be converted to an array.  This
            includes lists, lists of tuples, tuples, tuples of tuples, tuples
            of lists and ndarrays.
        dtype : data-type, optional
            By default, the data-type is inferred from the input data.
        order : {'C', 'F'}, optional
            Whether to use row-major (C-style) or
            column-major (Fortran-style) memory representation.
            Defaults to 'C'.
    
        Returns
        -------
        out : ndarray
            Array interpretation of `a`.  No copy is performed if the input
            is already an ndarray with matching dtype and order.  If `a` is a
            subclass of ndarray, a base class ndarray is returned.
    
        See Also
        --------
        asanyarray : Similar function which passes through subclasses.
        ascontiguousarray : Convert input to a contiguous array.
        asfarray : Convert input to a floating point ndarray.
        asfortranarray : Convert input to an ndarray with column-major
                         memory order.
        asarray_chkfinite : Similar function which checks input for NaNs and Infs.
        fromiter : Create an array from an iterator.
        fromfunction : Construct an array by executing a function on grid
                       positions.
    
        Examples
        --------
        Convert a list into an array:
    
        >>> a = [1, 2]
        >>> np.asarray(a)
        array([1, 2])
    
        Existing arrays are not copied:
    
        >>> a = np.array([1, 2])
        >>> np.asarray(a) is a
        True
    
        If `dtype` is set, array is copied only if dtype does not match:
    
        >>> a = np.array([1, 2], dtype=np.float32)
        >>> np.asarray(a, dtype=np.float32) is a
        True
        >>> np.asarray(a, dtype=np.float64) is a
        False
    
        Contrary to `asanyarray`, ndarray subclasses are not passed through:
    
        >>> issubclass(np.recarray, np.ndarray)
        True
        >>> a = np.array([(1.0, 2), (3.0, 4)], dtype='f4,i4').view(np.recarray)
        >>> np.asarray(a) is a
        False
        >>> np.asanyarray(a) is a
        True
    
        """
>       return array(a, dtype, copy=False, order=order)
E       ValueError: setting an array element with a sequence.

/root/miniforge3/envs/scikit-learn__scikit-learn__0.21/lib/python3.6/site-packages/numpy/core/_asarray.py:83: ValueError
______________________________ test_huber_sparse _______________________________
TypeError: float() argument must be a string or a number, not 'csr_matrix'

The above exception was the direct cause of the following exception:

    def test_huber_sparse():
        X, y = make_regression_with_outliers()
        huber = HuberRegressor(fit_intercept=True, alpha=0.1)
        huber.fit(X, y)
    
        X_csr = sparse.csr_matrix(X)
        huber_sparse = HuberRegressor(fit_intercept=True, alpha=0.1)
>       huber_sparse.fit(X_csr, y)

sklearn/linear_model/tests/test_huber.py:125: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
sklearn/linear_model/huber.py:253: in fit
    X = np.asarray(X, dtype=float)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = <50x20 sparse matrix of type '<class 'numpy.float64'>'
	with 1000 stored elements in Compressed Sparse Row format>
dtype = <class 'float'>, order = None

    @set_module('numpy')
    def asarray(a, dtype=None, order=None):
        """Convert the input to an array.
    
        Parameters
        ----------
        a : array_like
            Input data, in any form that can be converted to an array.  This
            includes lists, lists of tuples, tuples, tuples of tuples, tuples
            of lists and ndarrays.
        dtype : data-type, optional
            By default, the data-type is inferred from the input data.
        order : {'C', 'F'}, optional
            Whether to use row-major (C-style) or
            column-major (Fortran-style) memory representation.
            Defaults to 'C'.
    
        Returns
        -------
        out : ndarray
            Array interpretation of `a`.  No copy is performed if the input
            is already an ndarray with matching dtype and order.  If `a` is a
            subclass of ndarray, a base class ndarray is returned.
    
        See Also
        --------
        asanyarray : Similar function which passes through subclasses.
        ascontiguousarray : Convert input to a contiguous array.
        asfarray : Convert input to a floating point ndarray.
        asfortranarray : Convert input to an ndarray with column-major
                         memory order.
        asarray_chkfinite : Similar function which checks input for NaNs and Infs.
        fromiter : Create an array from an iterator.
        fromfunction : Construct an array by executing a function on grid
                       positions.
    
        Examples
        --------
        Convert a list into an array:
    
        >>> a = [1, 2]
        >>> np.asarray(a)
        array([1, 2])
    
        Existing arrays are not copied:
    
        >>> a = np.array([1, 2])
        >>> np.asarray(a) is a
        True
    
        If `dtype` is set, array is copied only if dtype does not match:
    
        >>> a = np.array([1, 2], dtype=np.float32)
        >>> np.asarray(a, dtype=np.float32) is a
        True
        >>> np.asarray(a, dtype=np.float64) is a
        False
    
        Contrary to `asanyarray`, ndarray subclasses are not passed through:
    
        >>> issubclass(np.recarray, np.ndarray)
        True
        >>> a = np.array([(1.0, 2), (3.0, 4)], dtype='f4,i4').view(np.recarray)
        >>> np.asarray(a) is a
        False
        >>> np.asanyarray(a) is a
        True
    
        """
>       return array(a, dtype, copy=False, order=order)
E       ValueError: setting an array element with a sequence.

/root/miniforge3/envs/scikit-learn__scikit-learn__0.21/lib/python3.6/site-packages/numpy/core/_asarray.py:83: ValueError
==================================== PASSES ====================================
=========================== short test summary info ============================
PASSED sklearn/linear_model/tests/test_huber.py::test_huber_equals_lr_for_high_epsilon
PASSED sklearn/linear_model/tests/test_huber.py::test_huber_max_iter
PASSED sklearn/linear_model/tests/test_huber.py::test_huber_gradient
PASSED sklearn/linear_model/tests/test_huber.py::test_huber_scaling_invariant
PASSED sklearn/linear_model/tests/test_huber.py::test_huber_and_sgd_same_results
PASSED sklearn/linear_model/tests/test_huber.py::test_huber_warm_start
PASSED sklearn/linear_model/tests/test_huber.py::test_huber_better_r2_score
PASSED sklearn/linear_model/tests/test_huber.py::test_huber_bool
FAILED sklearn/linear_model/tests/test_huber.py::test_huber_sample_weights - ...
FAILED sklearn/linear_model/tests/test_huber.py::test_huber_sparse - ValueErr...
========================= 2 failed, 8 passed in 0.92s ==========================

ERROR conda.cli.main_run:execute(125): `conda run pytest -rA sklearn/linear_model/tests/test_huber.py` failed. (See above for error)
