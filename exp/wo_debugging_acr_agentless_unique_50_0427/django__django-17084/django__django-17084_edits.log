### your_app/queries.py
<<<<<<< SEARCH
queryset = queryset.annotate(
    cumul_DJR=Coalesce(Window(Sum("DJR"), order_by=F("date").asc()), 0.0)
)
aggregate = queryset.aggregate(
    DJR_total=Sum("DJR"),
    cumul_DJR_total=Sum("cumul_DJR")
)
=======
from django.db.models import OuterRef, Subquery, Sum, Coalesce, Window, F

# Create a separate annotated queryset for the window function
cumulative_subquery = queryset.annotate(
    cumul_DJR=Coalesce(Window(Sum("DJR"), order_by=F("date").asc()), 0.0)
).filter(pk=OuterRef('pk')).values('cumul_DJR')[:1]

# Use Subquery to include the window function result
queryset = queryset.annotate(
    cumul_DJR=Subquery(cumulative_subquery)
)

# Perform the aggregation
aggregate = queryset.aggregate(
    DJR_total=Sum("DJR"),
    cumul_DJR_total=Sum("cumul_DJR")
)
>>>>>>> REPLACE
