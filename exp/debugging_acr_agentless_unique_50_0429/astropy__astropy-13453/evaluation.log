============================= test session starts ==============================
platform linux -- Python 3.9.21, pytest-7.1.0, pluggy-1.3.0

Running tests with Astropy version 5.2.dev266+g19cc804717.d20250429.
Running tests in astropy/io/ascii/tests/test_html.py.

Date: 2025-04-29T10:53:17

Platform: Linux-5.15.0-105-generic-x86_64-with-glibc2.31

Executable: /root/miniforge3/envs/astropy__astropy__5.0/bin/python3.9

Full Python Version: 
3.9.21 | packaged by conda-forge | (main, Dec  5 2024, 13:51:40) 
[GCC 13.3.0]

encodings: sys: utf-8, locale: UTF-8, filesystem: utf-8
byteorder: little
float info: dig: 15, mant_dig: 15

Package versions: 
Numpy: 1.25.2
Scipy: not available
Matplotlib: not available
h5py: not available
Pandas: not available
PyERFA: 2.0.0.3
Cython: not available
Scikit-image: not available
asdf: not available
pyarrow: not available

Using Astropy options: remote_data: none.

ARCH_ON_CI: undefined
IS_CRON: undefined

rootdir: /data/swe-fl/TMP/testbed/astropy__astropy-13453, configfile: setup.cfg
plugins: doctestplus-1.0.0, xdist-3.3.1, arraydiff-0.5.0, remotedata-0.4.0, astropy-header-0.2.2, openfiles-0.5.0, astropy-0.10.0, filter-subpackage-0.1.2, hypothesis-6.46.7, mock-3.11.1, cov-4.1.0
collected 26 items

astropy/io/ascii/tests/test_html.py s.ssssss.ssss.s.sss.....Fs           [100%]

=================================== FAILURES ===================================
______________________ test_write_table_formatted_columns ______________________

    def test_write_table_formatted_columns():
        """
        Test to make sure that the HTML writer writes out using the
        supplied formatting.
        """
    
        col1 = [1, 2]
        col2 = [1.234567e-11, -9.876543e11]
        formats = {"C1": "04d", "C2": ".2e"}
        table = Table([col1, col2], names=formats.keys())
    
        expected = """\
    <html>
     <head>
      <meta charset="utf-8"/>
      <meta content="text/html;charset=UTF-8" http-equiv="Content-type"/>
     </head>
     <body>
      <table>
       <thead>
        <tr>
         <th>C1</th>
         <th>C2</th>
        </tr>
       </thead>
       <tr>
        <td>0001</td>
        <td>1.23e-11</td>
       </tr>
       <tr>
        <td>0002</td>
        <td>-9.88e+11</td>
       </tr>
      </table>
     </body>
    </html>
        """
        with StringIO() as sp:
>           table.write(sp, format="html", formats=formats)

/data/swe-fl/TMP/testbed/astropy__astropy-13453/astropy/io/ascii/tests/test_html.py:758: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/data/swe-fl/TMP/testbed/astropy__astropy-13453/astropy/table/connect.py:129: in __call__
    self.registry.write(instance, *args, **kwargs)
/data/swe-fl/TMP/testbed/astropy__astropy-13453/astropy/io/registry/core.py:369: in write
    return writer(data, *args, **kwargs)
/data/swe-fl/TMP/testbed/astropy__astropy-13453/astropy/io/ascii/connect.py:26: in io_write
    return write(table, filename, **kwargs)
/data/swe-fl/TMP/testbed/astropy__astropy-13453/astropy/io/ascii/ui.py:860: in write
    lines = writer.write(table)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <astropy.io.ascii.html.HTML object at 0x7efdb3dce250>
table = <Table length=2>
  C1         C2      
int64     float64    
----- ---------------
    1    1.234567e-11
    2 -987654300000.0

    def write(self, table):
        """
        Return data in ``table`` converted to HTML as a list of strings.
        """
        # Check that table has only 1-d or 2-d columns. Above that fails.
        self._check_multidim_table(table)
    
        cols = list(table.columns.values())
    
        self.data.header.cols = cols
    
        if isinstance(self.data.fill_values, tuple):
            self.data.fill_values = [self.data.fill_values]
    
        self.data._set_fill_values(cols)
    
        lines = []
    
        # Set HTML escaping to False for any column in the raw_html_cols input
        raw_html_cols = self.html.get('raw_html_cols', [])
        if isinstance(raw_html_cols, str):
            raw_html_cols = [raw_html_cols]  # Allow for a single string as input
        cols_escaped = [col.info.name not in raw_html_cols for col in cols]
    
        # Kwargs that get passed on to bleach.clean() if that is available.
        raw_html_clean_kwargs = self.html.get('raw_html_clean_kwargs', {})
    
        # Use XMLWriter to output HTML to lines
        w = writer.XMLWriter(ListWriter(lines))
    
        with w.tag('html'):
            with w.tag('head'):
                # Declare encoding and set CSS style for table
                with w.tag('meta', attrib={'charset': 'utf-8'}):
                    pass
                with w.tag('meta', attrib={'http-equiv': 'Content-type',
                                           'content': 'text/html;charset=UTF-8'}):
                    pass
                if 'css' in self.html:
                    with w.tag('style'):
                        w.data(self.html['css'])
                if 'cssfiles' in self.html:
                    for filename in self.html['cssfiles']:
                        with w.tag('link', rel="stylesheet", href=filename, type='text/css'):
                            pass
                if 'jsfiles' in self.html:
                    for filename in self.html['jsfiles']:
                        with w.tag('script', src=filename):
                            w.data('')  # need this instead of pass to get <script></script>
            with w.tag('body'):
                if 'js' in self.html:
                    with w.xml_cleaning_method('none'):
                        with w.tag('script'):
                            w.data(self.html['js'])
                if isinstance(self.html['table_id'], str):
                    html_table_id = self.html['table_id']
                else:
                    html_table_id = None
                if 'table_class' in self.html:
                    html_table_class = self.html['table_class']
                    attrib = {"class": html_table_class}
                else:
                    attrib = {}
                with w.tag('table', id=html_table_id, attrib=attrib):
                    with w.tag('thead'):
                        with w.tag('tr'):
                            for col in cols:
                                if len(col.shape) > 1 and self.html['multicol']:
                                    # Set colspan attribute for multicolumns
                                    w.start('th', colspan=col.shape[1])
                                else:
                                    w.start('th')
                                w.data(col.info.name.strip())
                                w.end(indent=False)
                        col_str_iters = []
                        new_cols_escaped = []
    
                        # Make a container to hold any new_col objects created
                        # below for multicolumn elements.  This is purely to
                        # maintain a reference for these objects during
                        # subsequent iteration to format column values.  This
                        # requires that the weakref info._parent be maintained.
                        new_cols = []
    
                        for col, col_escaped in zip(cols, cols_escaped):
                            if len(col.shape) > 1 and self.html['multicol']:
                                span = col.shape[1]
                                for i in range(span):
                                    # Split up multicolumns into separate columns
                                    new_col = Column([el[i] for el in col])
    
                                    new_col_iter_str_vals = self.fill_values(
                                        col, new_col.info.iter_str_vals())
                                    col_str_iters.append(new_col_iter_str_vals)
                                    new_cols_escaped.append(col_escaped)
                                    new_cols.append(new_col)
                            else:
    
                                col_iter_str_vals = self.fill_values(col, col.info.iter_str_vals())
                                col_str_iters.append(col_iter_str_vals)
    
                                new_cols_escaped.append(col_escaped)
    
                    for row in zip(*col_str_iters):
                        with w.tag('tr'):
                            for el, col_escaped in zip(row, new_cols_escaped):
                                # Potentially disable HTML escaping for column
                                method = ('escape_xml' if col_escaped else 'bleach_clean')
                                with w.xml_cleaning_method(method, **raw_html_clean_kwargs):
                                    w.start('td')
                                    # Apply formatting if specified for column
                                    if col.info.name in self.data.formats:
                                        format_func = self.data.formats[col.info.name]
>                                       w.data(format_func(el).strip())
E                                       TypeError: 'str' object is not callable

/data/swe-fl/TMP/testbed/astropy__astropy-13453/astropy/io/ascii/html.py:455: TypeError
==================================== PASSES ====================================
____________ test_multi_column_write_table_html_fill_values_masked _____________
----------------------------- Captured stdout call -----------------------------
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="text/html;charset=UTF-8" http-equiv="Content-type"/>
 </head>
 <body>
  <table>
   <thead>
    <tr>
     <th>a</th>
     <th>b</th>
    </tr>
   </thead>
   <tr>
    <td>MASKED</td>
    <td>MASKED</td>
   </tr>
   <tr>
    <td>MASKED</td>
    <td>MASKED</td>
   </tr>
   <tr>
    <td>3</td>
    <td>--</td>
   </tr>
   <tr>
    <td>4</td>
    <td>b</td>
   </tr>
  </table>
 </body>
</html>


=========================== short test summary info ============================
PASSED astropy/io/ascii/tests/test_html.py::test_listwriter
PASSED astropy/io/ascii/tests/test_html.py::test_htmlinputter_no_bs4
PASSED astropy/io/ascii/tests/test_html.py::test_multicolumn_write
PASSED astropy/io/ascii/tests/test_html.py::test_write_no_multicols
PASSED astropy/io/ascii/tests/test_html.py::test_write_table_html_fill_values
PASSED astropy/io/ascii/tests/test_html.py::test_write_table_html_fill_values_optional_columns
PASSED astropy/io/ascii/tests/test_html.py::test_write_table_html_fill_values_masked
PASSED astropy/io/ascii/tests/test_html.py::test_multicolumn_table_html_fill_values
PASSED astropy/io/ascii/tests/test_html.py::test_multi_column_write_table_html_fill_values_masked
SKIPPED [1] astropy/io/ascii/tests/test_html.py:29: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:60: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:86: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:114: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:136: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:154: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:174: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:207: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:250: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:277: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:317: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:429: condition: not HAS_BLEACH
SKIPPED [1] astropy/io/ascii/tests/test_html.py:537: condition: not HAS_BS4
SKIPPED [1] astropy/io/ascii/tests/test_html.py:556: condition: not HAS_BLEACH
SKIPPED [1] astropy/io/ascii/tests/test_html.py:589: condition: not HAS_BLEACH
SKIPPED [1] astropy/io/ascii/tests/test_html.py:763: condition: not HAS_BS4
FAILED astropy/io/ascii/tests/test_html.py::test_write_table_formatted_columns
=================== 1 failed, 9 passed, 16 skipped in 0.19s ====================

<frozen importlib._bootstrap>:228: RuntimeWarning: numpy.ndarray size changed, may indicate binary incompatibility. Expected 80 from C header, got 96 from PyObject

ERROR conda.cli.main_run:execute(125): `conda run pytest -rA astropy/io/ascii/tests/test_html.py` failed. (See above for error)
