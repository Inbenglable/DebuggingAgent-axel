To generate the patch, I need to understand the context where `opts = cur_model._meta` is used. The snippet provided includes the surrounding code, but to be certain of the fix, I need to see if that snippet is within a function or class. Therefore, I will search for the surrounding code structure to determine where this line resides.

```python
search_code_in_file("django/db/models/sql/query.py", "cur_model = source.related_model")
```

